!function(){function a(a,b){var c=b||"12px arial",d=$("<div>"+a+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:c}).appendTo($("body")),e=d.width();return d.remove(),e}var b='<div id="{{ grid.getCssPrefix() }}" class="grid-container" ng-show="grid._data && grid._data.length"><div id="mf-grid-{{ grid._id }}-style"></div><div class="grid-header" ng-show="grid.showHeaderRow"><div class="grid-header-content"></div></div><div class="grid-body overthrow"><div class="grid-body-viewport-content"><div class="grid-body-content"></div></div></div></div>',c='<div class="grid-row"><div ng-if="grid.showSelectionCheckbox" class="grid-column grid-checkbox-column"><input ng-if="grid.multiSelect" ng-checked="grid.allItemsSelected" title="Select All" type="checkbox" class="check-all" /></div><div ng-repeat="column in grid.enabledColumns" ng-class="{ \'grid-column-sortable\': grid.enableSorting }" ng-click="headerColumnClick(column, $index)" class="grid-column {{ column.getHeaderClassName() }}">{{ column.displayName }}<div ng-show="grid.enableSorting && grid.sortColumn && grid.sortColumn.field === column.field"'+" class=\"grid-sort-icon glyphicon glyphicon-chevron-{{ grid.sortAsc ? 'up' : 'down' }} icon-chevron-{{ grid.sortAsc ? 'up' : 'down' }}\"></div></div></div>",d='<div mf-grid-row ng-repeat="item in grid.visibleItems track by $index" class="grid-row"><div ng-if="grid.showSelectionCheckbox" class="grid-column grid-checkbox-column"><input ng-checked="isSelected" type="checkbox" /></div><div mf-grid-column ng-repeat="column in grid.enabledColumns" class="grid-column"></div></div>';jQuery.fn.isAutoHeight=function(){var a=this[0].style.height,b=this[0].style.maxHeight;if(a&&-1!==a.indexOf("px")||b&&-1!==b.indexOf("px"))return!1;var c=this.height(),d=$("<div></div>").css({clear:"both",height:c+10}).appendTo(this),e=this.height();return d.remove(),e>c},Array.prototype.remove=Array.prototype.remove||function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)};var e={};e.guessSortFn=function(a){var b=typeof a;switch(b){case"number":return e.sortNumber;case"boolean":return e.sortBool;case"string":return a.match(/^[-+]?[£$¤]?[\d,.]+%?$/)?e.sortNumberStr:e.sortAlpha;default:return"[object Date]"===Object.prototype.toString.call(a)?e.sortDate:e.basicSort}},e.basicSort=function(a,b){return a===b?0:b>a?-1:1},e.sortNumber=function(a,b){return a-b},e.sortNumberStr=function(a,b){var c,d,e=!1,f=!1;return c=parseFloat(a.replace(/[^0-9.-]/g,"")),isNaN(c)&&(e=!0),d=parseFloat(b.replace(/[^0-9.-]/g,"")),isNaN(d)&&(f=!0),e&&f?0:e?1:f?-1:c-d},e.sortAlpha=function(a,b){var c=a.toLowerCase(),d=b.toLowerCase();return c===d?0:d>c?-1:1},e.sortDate=function(a,b){var c=a.getTime(),d=b.getTime();return c===d?0:d>c?-1:1},e.sortBool=function(a,b){return a&&b?0:a||b?a?1:-1:0};var f=1,g=function(a){this._id=f,++f,this.$parse=a,this._data=[],this.enabledColumns=[],this.columns=[],this.selectedItems=[],this.visibleItems=[],this.columnDefs=[]};g.prototype={_id:null,_data:null,_css:"",afterSelectionChange:null,columnDefs:null,showSelectionCheckbox:!1,showHeaderRow:!0,columns:null,enabledColumns:null,selectedItems:null,multiSelect:!0,allItemsSelected:!1,trackItemBy:null,$parse:null,visibleItems:null,virtualizationThreshold:50,virtualizationOverflow:4,virtualizationInterval:2,snapping:!1,itemsBefore:0,pixelsBefore:0,height:null,viewportHeight:0,headerRowHeight:0,enableSorting:!0,rowHeight:30,scrollTop:0,sortColumn:null,_prevSortColumn:null,_prevSortAsc:!1,sortAsc:!0,_oldLength:0,headerColumnClick:null,rowClick:null,sortByColumn:function(a,b){if(this._prevSortColumn===a){if(this._prevSortAsc===b)return;return this._prevSortAsc=b,void this._data.reverse()}this._prevSortAsc=b,this._prevSortColumn=this.sortColumn=a;var c=a.sortFn;this._data.sort(function(b,d){b=a.getRawValue(b),d=a.getRawValue(d);var f="undefined"!=typeof b&&null!==b,g="undefined"!=typeof d&&null!==d;return f||g?f&&!g?-1:!f&&g?1:("undefined"==typeof c&&(c=e.guessSortFn(b)),c(b,d)):0})},isColumnSortable:function(a){return this.enableSorting&&a.sortable},setViewportHeight:function(a){this.viewportHeight=a,this.updateVisibleItems()},setScrollTop:function(a){this.scrollTop=a||0,this.updateVisibleItems()},updateVisibleItems:function(){var a=this.rowHeight,b=this._data.length,c=Math.ceil(this.viewportHeight/a);this.totalHeight=b*a,this.pixelsBefore=0;var d=this.itemsBefore=~~(this.scrollTop/a);if(c>=b||b<=this.virtualizationThreshold)return this.visibleItems=this._data,this.itemsBefore=0,void(this.renderedItemsBefore=d);var e=this.virtualizationOverflow;this.itemsBefore-=this.itemsBefore%this.virtualizationInterval;var f=Math.min(e,this.itemsBefore);this.itemsBefore=this.itemsBefore-f,this.renderedItemsBefore=d-this.itemsBefore,this.pixelsBefore=this.itemsBefore*a;var g=Math.min(this.itemsBefore+c+(e+f),b);this.visibleItems=this._data&&"function"==typeof this._data.slice?this._data.slice(this.itemsBefore,g):[]},isItemSelected:function(a){return-1!==this.selectedItems.indexOf(a)},updateCheckAll:function(){if(this.multiSelect===!1&&this.selectedItems.length>1){var a=this.selectedItems[this.selectedItems.length-1];this.selectedItems.length=1,this.selectedItems[0]=a}this.allItemsSelected=this._data.length===this.selectedItems.length},selectItem:function(a,b){if(this.multiSelect===!1)return this.selectedItems.length=0,this.selectedItems.push(a),void this.updateCheckAll();var c=this.selectedItems.indexOf(a),d=-1!==c;b&&d||!b&&!d||(b?this.selectedItems.push(a):this.selectedItems.remove(c),this.updateCheckAll())},selectAll:function(a){if(!a)return this.allItemsSelected=!1,void(this.selectedItems.length=0);for(var b=0,c=this._data.length;c>b;++b)this.selectedItems.push(this._data[b]);this.allItemsSelected=!0},buildColumn:function(b){function c(a){return b.isScopeKey===!0?!0:"undefined"==typeof a?!1:(("undefined"!=typeof a[b.field]||a.hasOwnProperty(b.field))&&(b.isScopeKey=!0),b.isScopeKey||!1)}function d(a){return b.isParentScopeKey===!0?!0:"undefined"==typeof a?!1:(("undefined"!=typeof a[b.field]||a.hasOwnProperty(b.field))&&(b.isParentScopeKey=!0),b.isParentScopeKey||!1)}function e(a){return b.isItemKey===!0?!0:"undefined"==typeof a?!1:(("undefined"!=typeof a[b.field]||a.hasOwnProperty(b.field))&&(b.isItemKey=!0),b.isItemKey||!1)}function f(){return"string"==typeof b.cellFilter&&b.cellFilter.length>0}var g=this;"string"==typeof b&&(b={field:b}),"undefined"==typeof b.displayName&&(b.displayName=b.field),"undefined"==typeof b.visible&&(b.visible=!0),"undefined"==typeof b.sortable&&(b.sortable=!0);var h;b.getRawValue=function(a,b){return e(a)?a[this.field]:c(b)?b[this.field]:d(g.$scope)?g.$scope[this.field]:("function"!=typeof h&&(h=g.$parse(this.field)),h(a,g.$scope))};var i;return b.getFilteredValue=function(a,b){return f()?("function"!=typeof i&&(i=g.$parse(this.field+" | "+this.cellFilter)),i(a,b)):this.getRawValue(a,b)},b.getLongestValue=function(){var a=this.displayName;if(!g._data||!g._data.length)return a;for(var c=g._data.length,d=20,e=d/2,f=function(c){var d=b.getFilteredValue(c);if(null!==d&&"undefined"!=typeof d&&"undefined"!=typeof d.toString){var e=d.toString();e.length>a.length&&(a=e)}},h=0,i=Math.min(c,e);i>h;++h)f(g._data[h]);if(c>e)for(var h=c-1;h>c-e-1;--h)f(g._data[h]);return a},b.getClassName=function(){return"mf-grid-column-"+this.index},b.getHeaderClassName=function(){var a=this.getClassName();return this.headerClass&&(a+=" "+this.headerClass),a},b.getCellClassName=function(){var a=this.getClassName();return this.cellClass&&(a+=" "+this.cellClass),null===g.rowClick&&(a+=" grid-column-no-hover"),a},b.getWidth=function(){if("number"==typeof this.width)this.width+="px";else if("undefined"==typeof this.width||"auto"===this.width){var b=this.getLongestValue();if(null!==b&&"undefined"!=typeof b&&b.length>0){var c=$("#"+g.getCssPrefix()+" .grid-body-content").css("font");this.width=a(b,c)+28+"px"}}return this.width},b},setColumns:function(a){if(this.enabledColumns=[],this.columns=[],a&&a.length)for(var b=0,c=a.length;c>b;++b){var d=this.buildColumn(a[b]);d.index=b,this.columns.push(d),d.visible&&this.enabledColumns.push(d)}else if(this._data.length>0){var e=0;for(var f in this._data[0]){var d=this.buildColumn(f);d.index=e,this.columns.push(d),this.enabledColumns.push(d),++e}}this._css=this.getCss()},getCssPrefix:function(){return"mf-grid-"+this._id},getCss:function(){var a="#"+this.getCssPrefix(),b=[],c=this.columns;if(c&&c.length)for(var d=0,e=c.length;e>d;++d){var f=c[d];b.push(a+" ."+f.getClassName()+" {\nwidth: "+f.getWidth()+";\n}")}return b.join("\n")},setData:function(a){var b=this._data!==a||this._oldLength!==a.length;(null===a||"undefined"==typeof a)&&(a=[]),this._data=a,this._oldLength=a.length;for(var c=[],d=0,e=this.selectedItems.length;e>d;++d){var f=this.selectedItems[d];if(-1===a.indexOf(f)){if(null!==this.trackItemBy&&"string"==typeof this.trackItemBy&&"undefined"!=typeof f[this.trackItemBy])for(var g=0,h=a.length;h>g;++g){var i=a[g];if(null!==i&&"undefined"!=typeof i&&f[this.trackItemBy]===i[this.trackItemBy]){c.push(i);break}}}else c.push(f)}this.selectedItems=c,this.updateCheckAll(),this.setColumns(this.columnDefs),b&&"function"!=typeof this.headerColumnClick&&this.sortColumn&&this.sortByColumn(this.sortColumn,this.sortAsc),this.updateVisibleItems()}},angular.module("mfGrid",[]).controller("MfGridCtrl",["$parse",function(a){return new g(a)}]).directive("mfGrid",["$http","$templateCache","$compile","$parse","$timeout","$window",function(a,e,f,g,h,i){function j(b,j,k,l){function m(){var a=document.createElement("p");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.visibility="hidden",b.style.width="200px",b.style.height="150px",b.style.overflow="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;return c===d&&(d=b.clientWidth),document.body.removeChild(b),c-d}function n(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function o(a,c){a.prepend(c),f(a.contents())(b)}function p(){x[0].style.transform="translate3d(0px,"+l.pixelsBefore+"px, 0px)",x[0].style["-webkit-transform"]="translate3d(0px,"+l.pixelsBefore+"px, 0px)",x[0].style["-moz-transform"]="translate3d(0px,"+l.pixelsBefore+"px, 0px)",x[0].style["-ms-transform"]="translate3d(0px,"+l.pixelsBefore+"px, 0px)"}function q(a){var b=a.closest(".grid-row").scope();if(b)return b.item}var r=angular.element,s=j.find(".grid-header"),t=s.find(".grid-header-content"),u=j.find(".grid-body"),v=u[0],w=j.find(".grid-body-viewport-content"),x=j.find(".grid-body-content"),y=g(l.data),z=m(),A=window,B=r(i);if(!v)throw new Error(".grid-body not found.");l.rowTemplateUrl||l.rowTemplate||(l.rowTemplate=d),l.rowTemplate?o(x,l.rowTemplate):a.get(l.rowTemplateUrl,{cache:e}).success(function(a){o(x,a)}),l.headerRowTemplateUrl||l.headerRowTemplate||(l.headerRowTemplate=c),l.headerRowTemplate?o(t,l.headerRowTemplate):a.get(l.headerRowTemplateUrl,{cache:e}).success(function(a){o(t,a)}),l.rowHeight=parseInt(l.rowHeight,10)||50,b.$watchCollection(function(){return y(b.$parent)},function(a){l.setData(a),h(function(){D(),b.$broadcast("mf-grid-data-change",a)})}),b.$watchCollection("grid.columnDefs",function(a,b){l.setColumns(a)}),b.$watchCollection("grid.selectedItems",function(){l.updateCheckAll(),l.afterSelectionChange&&l.afterSelectionChange(l.selectedItems),b.$broadcast("mf-grid-selection-change",l.selectedItems)}),b.$watch("grid.multiSelect",function(){l.updateCheckAll()}),b.$watch("grid._css",function(a){var b=angular.element("#mf-grid-"+l._id+"-style")[0];b.innerHTML="<style>"+a+"</style>"}),l.scrollToItem=function(a,b){b=b||0,h(function(){var c=l._data.indexOf(a);-1!==c&&r(A).animate({scrollTop:c*l.rowHeight},b)})};var C=!1,D=function(){var a=parseInt(l.headerRowHeight,10)||0,c=s.find(".grid-row");j.isAutoHeight()?(A=window,C=!0,u.css("position","static")):(A=v,C=!1,u.css({position:"absolute",top:0,bottom:0,left:0,right:0})),l.showHeaderRow||(a=0),0!==c.length?(c[0].style.height=a+"px",v.style.marginTop=s[0].offsetHeight||a+"px"):v.style.marginTop=a+"px",v.scrollHeight>v.offsetHeight?b.scrollbarWidth=z:b.scrollbarWidth=0;var d;if(C){d=B.height();var e=j.offset().top-window.scrollY;e>0&&(d-=e)}else d=v.offsetHeight;l.setViewportHeight(d)};b.$watch(n(function(){return j.height()},200),D);var E=n(function(){D(),b.$digest()},50);B.on("resize",E);var F=n(function(){C&&G()},10);B.on("scroll",F),b.$on("$destroy",function(){try{B.off("resize",E),B.off("scroll",F)}catch(a){}b.headerColumnClick=null,l._data=null,l.selectedItems=null,l.visibleItems=null,l.columns=null,l.columnDefs=null,l.enabledColumns=null,l.$parse=null,l.$scope=null,l=null,b.grid=null,j=null,s=null,t=null,u=null,v=null,w=null,x=null,b=null}),b.$watch("grid.height",n(function(a){"undefined"!=typeof a&&""!==a&&null!==a&&j.css("height",a),h(function(){D()})},50)),s.css("margin-right",z+"px"),b.$watch("grid.totalHeight",n(function(a){"undefined"!=typeof a&&null!==a&&w.css("height",a+"px")},50)),b.$watch("grid.headerRowHeight",n(function(a){h(function(){D()})},50)),b.headerColumnClick=function(a,b){l.enableSorting&&(l.sortColumn&&a&&l.sortColumn.field===a.field?l.sortAsc=!l.sortAsc:l.sortAsc=!0,l.sortColumn=a,"function"==typeof l.headerColumnClick?l.headerColumnClick("string"==typeof a.value?a.value:a,b,l.sortAsc):l.sortByColumn(a,l.sortAsc))},b.$watch("grid.pixelsBefore",p),b.$watch("grid.itemsBefore",function(a){b.$broadcast("mf-grid-items-before-change",a)});var G=function(){s[0].scrollLeft=v.scrollLeft;var a,c=l.pixelsBefore,d=l.visibleItems.length;a=C?Math.max(0,window.scrollY-j.offset().top):v.scrollTop,l.setScrollTop(a),(l.pixelsBefore!==c||l.visibleItems.length!==d)&&(p(),b.$digest())};v.addEventListener("scroll",G),v.addEventListener("touchmove",G),v.addEventListener("gesturechange",G),s.on("click","input.check-all",function(){l.selectAll(this.checked),b.$apply()}),x.on("click",".grid-column",function(a){if(!r(a.target).is("input:checkbox")){var c=r(this),d=q(c);d&&(c.is(".grid-checkbox-column")?(a.stopImmediatePropagation(),l.selectItem(d,!l.isItemSelected(d),a)):l.rowClick&&l.rowClick(d,l._data.indexOf(d),a),b.$apply())}}),x.on("click","input:checkbox",function(a){a.stopImmediatePropagation(),l.selectItem(q(angular.element(this)),this.checked,a),b.$apply()})}return{restrict:"A",scope:{grid:"=mfGrid"},replace:!0,controller:"MfGridCtrl",template:b,link:function(a,b,c,d){var e=a.grid||{};for(var f in e)e.hasOwnProperty(f)&&(d[f]=e[f]);a.grid=d,d.$scope=a.$parent,j(a,b,c,d)}}}]).directive("mfGridRow",[function(){return{restrict:"A",link:function(a,b){var c=a.grid;b[0].style.height=c.rowHeight+"px",a.rowClass={},a.$index%2===0?b.addClass("grid-row-odd"):b.addClass("grid-row-even");var d=function(){var d=a.isSelected,e=a.isSelected=c.isItemSelected(a.item);d!==e&&b[e?"addClass":"removeClass"]("grid-row-selected")};a.$on("mf-grid-selection-change",d);var e=function(){a.itemIndex=(c.itemsBefore||0)+a.$index};a.$on("mf-grid-items-before-change",e),a.$on("mf-grid-items-before-change",d),e()}}}]).directive("mfGridColumn",[function(){return{restrict:"A",link:function(a,b){var c=b[0];c.className+=" "+a.column.getCellClassName();var d="";a.$watch(function(){var b=a.column.getFilteredValue(a.item,a.$parent);(null===b||"undefined"==typeof b)&&(b=""),b!==d&&(c.textContent=d=b)},function(){})}}}])}();